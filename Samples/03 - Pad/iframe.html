<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<title>Nugget Pad Sample IFrame</title>

        <style type="text/css">
            #pad {width:100%;height:100%;}
            .not_connected {background-color:#dddddd;}
            .changed {background-color:lime;}
            
        </style>
        <script src="jquery-1.4.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            var ws;
            var pad;
            var current;
            $(document).ready(function () {
                ws = new WebSocket('ws://localhost:8181/padsample');
                pad = $('#pad');
                current = $('#pad span');

                ws.onmessage = function (evt) {
                    // do the stuff
                };

                ws.onopen = function () {
                    pad.innerHTML = "";
                    pad.removeClass('not_connected');
                };

                ws.onclose = function () {
                    pad.addClass('not_connected');
                }


                pad.click(function () {
                    setCurrent($('#pad span:last'));
                });

                pad.keydown(function (evt) {
                    var charCode = evt.originalEvent.keyIdentifier.split('+')[1];

                    if (evt.keyCode == 8) { // backspace
                        var tmp = current;
                        setCurrent(current.prev());
                        tmp.remove();
                        return false;
                    }

                    if (evt.keyCode == 46) { // delete
                        var tmp = current;
                        if (current.next()) {
                            setCurrent(current.next());
                            tmp.remove();
                        }
                        return false;
                    }

                    if (evt.keyCode == 32) { //space
                        var span = $('<span/>');
                        span.append('&nbsp;');

                        span.click(function () {
                            setCurrent(span);
                            return false;
                        });

                        current.after(span);
                        setCurrent(span);
                        return false;
                    }

                    if (charCode === undefined) {
                        return true;
                    }

                    var u = '\\u' + charCode;
                    eval("u = '" + u + "'");
                    var span = $('<span/>');
                    span.append(u.toLowerCase());

                    span.click(function () {
                        setCurrent(span);
                        return false;
                    });

                    current.after(span);
                    setCurrent(span);

                    return false;
                });
            });

            function setCurrent(c) {
                current.removeClass('current');
                current = c;
                current.addClass('current');
            }
        </script>
	</head>
	<body>
        
	    <div id="pad" class="not_connected"><span></span></div>
	</body>
</html>