<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<title>nugget sample 2: chat</title>
        <script src="jquery-1.5.2.min.js" type="text/javascript"></script>
	</head>
	<body>
        <div id="connection-status"></div>
        <div id="chat-window"></div>
        
        <div id="chat-controls">
            <form action="">
                <input type="text" id="chat-msg" />
                <input type="submit" id="send" value="Send"/>
            </form>
        </div>

        <script type="text/javascript">
            var appendToChat = function (msg) {
                $('#chat-window').append(msg+'<br/>');
            }

            $('#connection-status').append("connecting.....");
            var ws = new WebSocket('ws://localhost:8181');

            ws.onmessage = function (evt) {
                var date = new Date(evt.timeStamp);
                var formattedTime = date.getHours() + ':' + date.getMinutes();
                appendToChat('(' + formattedTime + ') ' + evt.data);
            };
            
            ws.onopen = function () {
                $('#connection-status').html('connected!');
            };
            
            ws.onclose = function () {
                $('#connection-status').html('not connected');
            }

            $('#send').click(function () {
                ws.send($('#chat-msg').val());
                $('#chat-msg').val('');
                return false;
            });

        </script>
	</body>
</html>